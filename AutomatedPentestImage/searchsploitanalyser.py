import csv 
import io
import subprocess
import time
import json

class SearchsploitAnalyser(object):
    def analyse_nmap_scan_results(self, input_report_xml_file_name, output_filename):
        scan_done_successfuly = self._search_exploits(input_report_xml_file_name, output_filename) 
        if (scan_done_successfuly):
            print ("Searchsploit has analysed nmap report: {0}, checked the exploit database and has generated a report file: {1}".format(input_report_xml_file_name, output_filename))
            return output_filename
        else:
            print("Something went wrong trying to analyse nmap reports")
            return "None"

    def _search_exploits(self, input_report_file_name, output_report_filename):
        try:
            with open(output_report_filename, "w") as output_file:
                search_exploit = subprocess.run(["searchsploit", "-p","--colour", "--nmap", input_report_file_name], stdout=output_file) #TODO add -u option in the final version
                search_exploit.check_returncode      
            return True
        except Exception as exception:
            print(exception)
            return False