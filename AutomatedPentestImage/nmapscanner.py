import nmap
import os
class Scanner(object):
    def Scan(self, target_address, scan_report_name):
        options = "-T5 -A -sS -sC" 
        #"-v -T5 -A -sU -sS -sV --version-intensity 9 -sC" 
        #-> highest possible intensity, for more details but longer scanning time
        ports = "1-10024"
        print("Starting nmap with {0} options on {1} ports:{2}".format(options,target_address, ports))
        self._scan_target_nmap(target_address, options, ports, scan_report_name)
        return scan_report_name

    def _scan_target_nmap(self, target_address, options, port_range, scan_report_name):
        nm = nmap.PortScanner() #initialize the portscanner
        self.nmap_scan_result = nm.scan(target_address, port_range, options)
        nm.scan(target_address, port_range, options)
        nmap_xml = nm.get_nmap_last_output()
        self._save_xml_report(nmap_xml, scan_report_name)
    
    def _save_xml_report(self, report, report_name):
        xml = report
        f = open(report_name, "w")
        f.write(xml)
        print("Nmap report path: {0}".format(os.path.realpath(report_name)))
        f.close()