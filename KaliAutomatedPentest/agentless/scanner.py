import nmap

class Scanner(object):
    def Scan(self, target_address, scan_report_name):
        options = "-v -T5 -A -sS -sC" 
        #"-v -T5 -A -sU -sS -sV --version-intensity 9 -sC" 
        #-> highest possible intensity, for more details but longer scanning time
        ports = "1-1024"
        self._scan_target_nmap(target_address, options, ports, scan_report_name)
        return self.nmap_scan_result_csv

    def _scan_target_nmap(self, target_address, options, port_range, scan_report_name):
        nm = nmap.PortScanner() #initialize the portscanner
        #self.nmap_scan_result = nm.scan(target_address, port_range, options)
        nm.scan(target_address, port_range, options)
        nmap_xml = nm.get_nmap_last_output()
        self._save_xml_report(nmap_xml, scan_report_name)
        self.nmap_scan_result_csv = nm.csv()
    
    def _save_xml_report(self, report, report_name):
        xml = report
        f = open(report_name, "w") #TODO use /home/ as it will be run in docker
        f.write(xml)
        f.close()