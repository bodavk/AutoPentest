from scanner import Scanner
from nmapanalyser import NmapResultAnalyser
from metasploitmanager import MetasploitManager
from reportgenerator import ReportGenerator
from asciidrawer import AsciiArtPrinter

def get_target():
    #TODO change with address from args
    # if the target wasn't specified by args, ask for it
    return "10.0.75.1-4"

def scan_target(target):
    scanner = Scanner()
    #scan_result = scanner.Scan(target, "report.xml")
    scan_result = "" #TODO uncomment
    return scan_result

def analyse(scan_results):
    analyser = NmapResultAnalyser()   
    analysis_report_filename = analyser.analyse_scan_results("report.xml")

def exploit(scan_report_file):
    msf = MetasploitManager()
    msf.set_targets(scan_report_file)
    msf.exploit()
    #TODO add other tools such as Nikto web scanner and sqlmap
    exploit_report = msf.generate_report()
    return exploit_report

#def report(scan_result, exploit_report):
#    report_generator = ReportGenerator()
#    report_generator.set_scan_results(scan_result)
#    report_generator.set_exploit_results(exploit_report)
#    report_generator.generate_report()

def draw_ascii_banner():
    printer = AsciiArtPrinter()
    printer.draw_ascii_banner_random_font("AutoPentest")

if __name__ == "__main__":
    draw_ascii_banner()

    target = get_target()

    scan_result_csv = scan_target(target)
 
    analyse("report.xml")

    exploits = exploit(scan_result_csv)

    #report(scan_result_csv, exploits)
