from scanner import Scanner
from nmapanalyser import NmapAnalyser
from metasploitmanager import MetasploitManager
from reportgenerator import ReportGenerator

def get_target():
    #TODO change with address from args
    return "scanme.nmap.org"

def scan_target(target):
    scanner = Scanner()
    scan_result = scanner.Scan(target)
    return scan_result

def analyse(scan_results):
    analyser = NmapAnalyser()   
    potential_entrypoints = analyser.analyse_scan_results(scan_result)
    return potential_entrypoints

def exploit(potential_entrypoints):
    msf = MetasploitManager()
    msf.set_targets(potential_entrypoints)
    msf.exploit()
    exploit_report = msf.generate_report()
    return exploit_report

def report(scan_result, exploit_report):
    report_generator = ReportGenerator()
    report_generator.set_scan_results(scan_result)
    report_generator.set_exploit_results(exploit_report)
    report_generator.generate_report()

if __name__ == "__main__":
    target = get_target()

    scan_result = scan_target(target)
 
    entrypoints = analyse(scan_result)

    exploits = exploit(entrypoints)

    report(scan_result, exploits)
